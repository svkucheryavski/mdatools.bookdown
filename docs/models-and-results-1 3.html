<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Models and results | Getting started with mdatools for R</title>
  <meta name="description" content="This is a user guide for mdatools — R package for preprocessing, exploring and analysis of multivariate data. The package provides methods mostly common for Chemometrics. The general idea of the package is to collect most of the common chemometric methods and give a similar user interface for using them. So if a user knows how to make a model and visualise results for one method, he or she can easily do this for the others." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Models and results | Getting started with mdatools for R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a user guide for mdatools — R package for preprocessing, exploring and analysis of multivariate data. The package provides methods mostly common for Chemometrics. The general idea of the package is to collect most of the common chemometric methods and give a similar user interface for using them. So if a user knows how to make a model and visualise results for one method, he or she can easily do this for the others." />
  <meta name="github-repo" content="svkucheryavski/mdatools.bookdown" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Models and results | Getting started with mdatools for R" />
  
  <meta name="twitter:description" content="This is a user guide for mdatools — R package for preprocessing, exploring and analysis of multivariate data. The package provides methods mostly common for Chemometrics. The general idea of the package is to collect most of the common chemometric methods and give a similar user interface for using them. So if a user knows how to make a model and visualise results for one method, he or she can easily do this for the others." />
  

<meta name="author" content="Sergey Kucheryavskiy" />


<meta name="date" content="2020-02-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="partial-least-squares-regression.html"/>
<link rel="next" href="plotting-methods-1.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="what-is-new.html"><a href="what-is-new.html"><i class="fa fa-check"></i>What is new</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="what-mdatools-can-do.html"><a href="what-mdatools-can-do.html"><i class="fa fa-check"></i>What mdatools can do?</a></li>
<li class="chapter" data-level="" data-path="how-to-install.html"><a href="how-to-install.html"><i class="fa fa-check"></i>How to install</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="datasets-and-plots.html"><a href="datasets-and-plots.html"><i class="fa fa-check"></i>Datasets and plots</a>
<ul>
<li class="chapter" data-level="" data-path="attributes-and-factors.html"><a href="attributes-and-factors.html"><i class="fa fa-check"></i>Attributes and factors</a>
<ul>
<li class="chapter" data-level="" data-path="attributes-and-factors.html"><a href="attributes-and-factors.html#package-specific-attributes"><i class="fa fa-check"></i>Package specific attributes</a></li>
<li class="chapter" data-level="" data-path="attributes-and-factors.html"><a href="attributes-and-factors.html#attributes-for-plots"><i class="fa fa-check"></i>Attributes for plots</a></li>
<li class="chapter" data-level="" data-path="attributes-and-factors.html"><a href="attributes-and-factors.html#special-methods-for-data-transformations"><i class="fa fa-check"></i>Special methods for data transformations</a></li>
<li class="chapter" data-level="" data-path="attributes-and-factors.html"><a href="attributes-and-factors.html#data-frames-with-factors"><i class="fa fa-check"></i>Data frames with factors</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="simple-plots.html"><a href="simple-plots.html"><i class="fa fa-check"></i>Simple plots</a>
<ul>
<li class="chapter" data-level="" data-path="simple-plots.html"><a href="simple-plots.html#scatter-plots"><i class="fa fa-check"></i>Scatter plots</a></li>
<li class="chapter" data-level="" data-path="simple-plots.html"><a href="simple-plots.html#line-plots"><i class="fa fa-check"></i>Line plots</a></li>
<li class="chapter" data-level="" data-path="simple-plots.html"><a href="simple-plots.html#bar-and-errorbar-plots"><i class="fa fa-check"></i>Bar and errorbar plots</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="plots-for-groups-of-objects.html"><a href="plots-for-groups-of-objects.html"><i class="fa fa-check"></i>Plots for groups of objects</a>
<ul>
<li class="chapter" data-level="" data-path="plots-for-groups-of-objects.html"><a href="plots-for-groups-of-objects.html#one-matrix-or-data-frame"><i class="fa fa-check"></i>One matrix or data frame</a></li>
<li class="chapter" data-level="" data-path="plots-for-groups-of-objects.html"><a href="plots-for-groups-of-objects.html#list-with-matrices-or-data-frames"><i class="fa fa-check"></i>List with matrices or data frames</a></li>
<li class="chapter" data-level="" data-path="plots-for-groups-of-objects.html"><a href="plots-for-groups-of-objects.html#use-factors-to-split-a-dataset-into-groups"><i class="fa fa-check"></i>Use factors to split a dataset into groups</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="working-with-images.html"><a href="working-with-images.html"><i class="fa fa-check"></i>Working with images</a></li>
<li class="chapter" data-level="" data-path="preprocessing.html"><a href="preprocessing.html"><i class="fa fa-check"></i>Preprocessing</a>
<ul>
<li class="chapter" data-level="" data-path="preprocessing.html"><a href="preprocessing.html#autoscaling"><i class="fa fa-check"></i>Autoscaling</a></li>
<li class="chapter" data-level="" data-path="preprocessing.html"><a href="preprocessing.html#correction-of-spectral-baseline"><i class="fa fa-check"></i>Correction of spectral baseline</a></li>
<li class="chapter" data-level="" data-path="preprocessing.html"><a href="preprocessing.html#smoothing-and-derivatives"><i class="fa fa-check"></i>Smoothing and derivatives</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html"><i class="fa fa-check"></i>Principal component analysis</a>
<ul>
<li class="chapter" data-level="" data-path="models-and-results.html"><a href="models-and-results.html"><i class="fa fa-check"></i>Models and results</a>
<ul>
<li class="chapter" data-level="" data-path="models-and-results.html"><a href="models-and-results.html#model-calibration"><i class="fa fa-check"></i>Model calibration</a></li>
<li class="chapter" data-level="" data-path="models-and-results.html"><a href="models-and-results.html#model-validation"><i class="fa fa-check"></i>Model validation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="plotting-methods.html"><a href="plotting-methods.html"><i class="fa fa-check"></i>Plotting methods</a>
<ul>
<li class="chapter" data-level="" data-path="plotting-methods.html"><a href="plotting-methods.html#support-for-images"><i class="fa fa-check"></i>Support for images</a></li>
<li class="chapter" data-level="" data-path="plotting-methods.html"><a href="plotting-methods.html#manual-x-values-for-loading-line-plot"><i class="fa fa-check"></i>Manual x-values for loading line plot</a></li>
<li class="chapter" data-level="" data-path="plotting-methods.html"><a href="plotting-methods.html#excluding-rows-and-columns"><i class="fa fa-check"></i>Excluding rows and columns</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="residuals-and-critical-limits.html"><a href="residuals-and-critical-limits.html"><i class="fa fa-check"></i>Residuals and critical limits</a>
<ul>
<li class="chapter" data-level="" data-path="residuals-and-critical-limits.html"><a href="residuals-and-critical-limits.html#distance-to-model-and-score-distance"><i class="fa fa-check"></i>Distance to model and score distance</a></li>
<li class="chapter" data-level="" data-path="residuals-and-critical-limits.html"><a href="residuals-and-critical-limits.html#critical-limits"><i class="fa fa-check"></i>Critical limits</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="model-complexity.html"><a href="model-complexity.html"><i class="fa fa-check"></i>Model complexity</a></li>
<li class="chapter" data-level="" data-path="randomized-pca-algorithms.html"><a href="randomized-pca-algorithms.html"><i class="fa fa-check"></i>Randomized PCA algorithms</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="simcadd-simca-classification.html"><a href="simcadd-simca-classification.html"><i class="fa fa-check"></i>SIMCA/DD-SIMCA classification</a>
<ul>
<li class="chapter" data-level="" data-path="calibration-and-validation.html"><a href="calibration-and-validation.html"><i class="fa fa-check"></i>Calibration and validation</a>
<ul>
<li class="chapter" data-level="" data-path="calibration-and-validation.html"><a href="calibration-and-validation.html#cross-validation"><i class="fa fa-check"></i>Cross-validation</a></li>
<li class="chapter" data-level="" data-path="calibration-and-validation.html"><a href="calibration-and-validation.html#predictions-and-validation-with-a-test-set"><i class="fa fa-check"></i>Predictions and validation with a test set</a></li>
<li class="chapter" data-level="" data-path="calibration-and-validation.html"><a href="calibration-and-validation.html#class-belonging-probabilities"><i class="fa fa-check"></i>Class belonging probabilities</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multiclass-classification.html"><a href="multiclass-classification.html"><i class="fa fa-check"></i>Multiclass classification</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="partial-least-squares-regression.html"><a href="partial-least-squares-regression.html"><i class="fa fa-check"></i>Partial least squares regression</a>
<ul>
<li class="chapter" data-level="" data-path="models-and-results-1.html"><a href="models-and-results-1.html"><i class="fa fa-check"></i>Models and results</a>
<ul>
<li class="chapter" data-level="" data-path="models-and-results-1.html"><a href="models-and-results-1.html#model-calibration-1"><i class="fa fa-check"></i>Model calibration</a></li>
<li class="chapter" data-level="" data-path="models-and-results-1.html"><a href="models-and-results-1.html#model-validation-1"><i class="fa fa-check"></i>Model validation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="plotting-methods-1.html"><a href="plotting-methods-1.html"><i class="fa fa-check"></i>Plotting methods</a>
<ul>
<li class="chapter" data-level="" data-path="plotting-methods-1.html"><a href="plotting-methods-1.html#excluding-rows-and-columns-1"><i class="fa fa-check"></i>Excluding rows and columns</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="variable-selection.html"><a href="variable-selection.html"><i class="fa fa-check"></i>Variable selection</a></li>
<li class="chapter" data-level="" data-path="distances-and-outlier-detection.html"><a href="distances-and-outlier-detection.html"><i class="fa fa-check"></i>Distances and outlier detection</a>
<ul>
<li class="chapter" data-level="" data-path="distances-and-outlier-detection.html"><a href="distances-and-outlier-detection.html#residual-distance-for-x-decomposition"><i class="fa fa-check"></i>Residual distance for X-decomposition</a></li>
<li class="chapter" data-level="" data-path="distances-and-outlier-detection.html"><a href="distances-and-outlier-detection.html#residual-distance-for-y-decomposition-and-total-distance"><i class="fa fa-check"></i>Residual distance for Y-decomposition and total distance</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="randomization-test.html"><a href="randomization-test.html"><i class="fa fa-check"></i>Randomization test</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="pls-discriminant-analysis.html"><a href="pls-discriminant-analysis.html"><i class="fa fa-check"></i>PLS Discriminant Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="calibration-of-pls-da-model.html"><a href="calibration-of-pls-da-model.html"><i class="fa fa-check"></i>Calibration of PLS-DA model</a></li>
<li class="chapter" data-level="" data-path="classification-plots.html"><a href="classification-plots.html"><i class="fa fa-check"></i>Classification plots</a></li>
<li class="chapter" data-level="" data-path="performance-plots.html"><a href="performance-plots.html"><i class="fa fa-check"></i>Performance plots</a></li>
<li class="chapter" data-level="" data-path="predictions-for-a-new-data.html"><a href="predictions-for-a-new-data.html"><i class="fa fa-check"></i>Predictions for a new data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="interval-pls.html"><a href="interval-pls.html"><i class="fa fa-check"></i>Interval PLS</a>
<ul>
<li class="chapter" data-level="" data-path="interval-pls.html"><a href="interval-pls.html#forward-ipls"><i class="fa fa-check"></i>Forward iPLS</a></li>
<li class="chapter" data-level="" data-path="interval-pls.html"><a href="interval-pls.html#backward-ipls"><i class="fa fa-check"></i>Backward iPLS</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Getting started with mdatools for R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="models-and-results-1" class="section level2">
<h2>Models and results</h2>
<p>Like we discussed for <a href="principal-component-analysis.html#principal-component-analysis">PCA</a>, <em>matools</em> creates two types of objects — a model and a result. Every time you build a PLS model you get a <em>model object</em>. Every time you apply the model to a dataset you get a <em>result object</em>. For PLS, the objects have classes <code>pls</code> and <code>plsres</code> correspondingly.</p>
<div id="model-calibration-1" class="section level3">
<h3>Model calibration</h3>
<p>Let’s use the same <em>People</em> data and create a PLS-model for prediction of <em>Shoesize</em> (column number four) using other 11 variables as predictors. As usual, we start with preparing datasets (we will also split the data into calibration and test subsets):</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="models-and-results-1.html#cb150-1"></a><span class="kw">library</span>(mdatools)</span>
<span id="cb150-2"><a href="models-and-results-1.html#cb150-2"></a><span class="kw">data</span>(people)</span>
<span id="cb150-3"><a href="models-and-results-1.html#cb150-3"></a></span>
<span id="cb150-4"><a href="models-and-results-1.html#cb150-4"></a>idx =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">4</span>, <span class="dv">32</span>, <span class="dv">4</span>)</span>
<span id="cb150-5"><a href="models-and-results-1.html#cb150-5"></a>Xc =<span class="st"> </span>people[<span class="op">-</span>idx, <span class="dv">-4</span>]</span>
<span id="cb150-6"><a href="models-and-results-1.html#cb150-6"></a>yc =<span class="st"> </span>people[<span class="op">-</span>idx, <span class="dv">4</span>, drop =<span class="st"> </span><span class="ot">FALSE</span>]</span>
<span id="cb150-7"><a href="models-and-results-1.html#cb150-7"></a>Xt =<span class="st"> </span>people[idx, <span class="dv">-4</span>]</span>
<span id="cb150-8"><a href="models-and-results-1.html#cb150-8"></a>yt =<span class="st"> </span>people[idx, <span class="dv">4</span>, drop =<span class="st"> </span><span class="ot">FALSE</span>]</span></code></pre></div>
<p>So <code>Xc</code> and <code>yc</code> are predictors and response values for calibration subset. Now let’s calibrate the model and show an information about the model object:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="models-and-results-1.html#cb151-1"></a>m =<span class="st"> </span><span class="kw">pls</span>(Xc, yc, <span class="dv">7</span>, <span class="dt">scale =</span> <span class="ot">TRUE</span>, <span class="dt">info =</span> <span class="st">&quot;Shoesize prediction model&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in selectCompNum.pls(model, selcrit = ncomp.selcrit): No
## validation results were found.</code></pre>
<p>You can notice that the calibration succeeded but there is also a warning about lack of validation. For supervised models, which have complexity parameter (in this case — number of components), doing proper validation is important as it helps to find the optimal complexity. When you calibrate PLS model the calibration also tries to find the optimal number (details will be discussed later in this chapter) and this needs some validation. The easiest thing to do is to use cross-validation, we start with its simplest form — the full cross-validation (<code>cv = 1</code>):</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="models-and-results-1.html#cb153-1"></a>m =<span class="st"> </span><span class="kw">pls</span>(Xc, yc, <span class="dv">7</span>, <span class="dt">scale =</span> <span class="ot">TRUE</span>, <span class="dt">cv =</span> <span class="dv">1</span>, <span class="dt">info =</span> <span class="st">&quot;Shoesize prediction model&quot;</span>)</span>
<span id="cb153-2"><a href="models-and-results-1.html#cb153-2"></a>m =<span class="st"> </span><span class="kw">selectCompNum</span>(m, <span class="dv">3</span>)</span></code></pre></div>
<p>Besides that, the procedure is very similar to PCA, here we use 7 latent variables and select 3 first as an optimal number using the same method, <code>selectCompNum()</code>.</p>
<p>Here is an info for the model object:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="models-and-results-1.html#cb154-1"></a><span class="kw">print</span>(m)</span></code></pre></div>
<pre><code>## 
## PLS model (class pls)
## 
## Call:
## selectCompNum.pls(obj = m, ncomp = 3)
## 
## Major fields:
## $ncomp - number of calculated components
## $ncomp.selected - number of selected components
## $coeffs - object (regcoeffs) with regression coefficients
## $xloadings - vector with x loadings
## $yloadings - vector with y loadings
## $weights - vector with weights
## $res - list with results (calibration, cv, etc)
## 
## Try summary(model) and plot(model) to see the model performance.</code></pre>
<p>As expected, we see loadings for predictors and responses, matrix with weights, and a special object (<code>regcoeffs</code>) for regression coefficients.</p>
<div id="regression-coefficients" class="section level4">
<h4>Regression coefficients</h4>
<p>The values for regression coefficients are available in <code>m.coeffs.values</code>, it is an array with dimension <em>nVariables x nComponents x nPredictors</em>. The reason to use the object instead of just an array is mainly for being able to get and plot regression coefficients for different methods. Besides that, it is possible to calculate confidence intervals and other statistics for the coefficients using Jack-Knife method (will be shown later), which produces extra entities.</p>
<p>The regression coefficients can be shown as plot using either function <code>plotRegcoeffs()</code> for the PLS model object or function <code>plot()</code> for the object with regression coefficients. You need to specify for which predictor (if you have more than one y-variable) and which number of components you want to see the coefficients for. By default it shows values for the optimal number of components and first y-variable as it is shown on example below.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="models-and-results-1.html#cb156-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb156-2"><a href="models-and-results-1.html#cb156-2"></a><span class="kw">plotRegcoeffs</span>(m)</span>
<span id="cb156-3"><a href="models-and-results-1.html#cb156-3"></a><span class="kw">plotRegcoeffs</span>(m, <span class="dt">ncomp =</span> <span class="dv">2</span>)</span>
<span id="cb156-4"><a href="models-and-results-1.html#cb156-4"></a><span class="kw">plot</span>(m<span class="op">$</span>coeffs, <span class="dt">ncomp =</span> <span class="dv">3</span>, <span class="dt">type =</span> <span class="st">&quot;b&quot;</span>, <span class="dt">show.labels =</span> <span class="ot">TRUE</span>)</span>
<span id="cb156-5"><a href="models-and-results-1.html#cb156-5"></a><span class="kw">plot</span>(m<span class="op">$</span>coeffs, <span class="dt">ncomp =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-106-1.png" width="864" /></p>
<p>The model keeps regression coefficients, calculated for centered and standardized data, without intercept, etc. Here are the values for three PLS components.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="models-and-results-1.html#cb157-1"></a><span class="kw">show</span>(m<span class="op">$</span>coeffs<span class="op">$</span>values[, <span class="dv">3</span>, <span class="dv">1</span>])</span></code></pre></div>
<pre><code>##       Height       Weight     Hairleng          Age 
##  0.210411676  0.197646483 -0.138824482  0.026613035 
##       Income         Beer         Wine          Sex 
## -0.000590693  0.148917913  0.138138095 -0.138824482 
##         Swim       Region           IQ 
##  0.223962000  0.010392542 -0.088658626</code></pre>
<p>You can see a summary for the regression coefficients object by calling function <code>summary()</code> for the object <code>m$coeffs</code> like it is show below. By default it shows only estimated regression coefficients for the selected y-variable and number of components. However, if you use cross-validation, <a href="https://en.wikipedia.org/wiki/Jackknife_resampling">Jack-Knifing</a> method will be used to compute some statistics, including standard error, p-value (for test if the coefficient is equal to zero in population) and confidence interval. All statistics in this case will be shown automatically with <code>summary()</code> as you can see below.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="models-and-results-1.html#cb159-1"></a><span class="kw">summary</span>(m<span class="op">$</span>coeffs)</span></code></pre></div>
<pre><code>## 
## Regression coefficients for Shoesize (ncomp = 1)
## ------------------------------------------------
##                Coeffs  Std. err. t-value p-value        2.5%
## Height    0.176077659 0.01594024   11.03   0.000  0.14310275
## Weight    0.175803980 0.01598815   10.98   0.000  0.14272997
## Hairleng -0.164627444 0.01638528  -10.04   0.000 -0.19852297
## Age       0.046606027 0.03718827    1.25   0.225 -0.03032377
## Income    0.059998121 0.04047132    1.47   0.155 -0.02372318
## Beer      0.133136867 0.01116749   11.89   0.000  0.11003515
## Wine      0.002751573 0.03542518    0.08   0.936 -0.07053100
## Sex      -0.164627444 0.01638528  -10.04   0.000 -0.19852297
## Swim      0.173739533 0.01516461   11.44   0.000  0.14236915
## Region   -0.031357608 0.03590576   -0.87   0.395 -0.10563433
## IQ       -0.003353428 0.03841171   -0.08   0.934 -0.08281410
##                97.5%
## Height    0.20905257
## Weight    0.20887799
## Hairleng -0.13073192
## Age       0.12353583
## Income    0.14371942
## Beer      0.15623859
## Wine      0.07603415
## Sex      -0.13073192
## Swim      0.20510992
## Region    0.04291911
## IQ        0.07610725
## 
## Degrees of freedom (Jack-Knifing): 23</code></pre>
<p>You can also get the corrected coefficients, which can be applied directly to the raw data (without centering and standardization), by using method <code>getRegcoeffs()</code>:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="models-and-results-1.html#cb161-1"></a><span class="kw">show</span>(<span class="kw">getRegcoeffs</span>(m, <span class="dt">ncomp =</span> <span class="dv">3</span>))</span></code></pre></div>
<pre><code>##               Estimated
## Intercept  1.251537e+01
## Height     8.105287e-02
## Weight     5.110732e-02
## Hairleng  -5.375404e-01
## Age        1.147785e-02
## Income    -2.580586e-07
## Beer       6.521476e-03
## Wine       1.253340e-02
## Sex       -5.375404e-01
## Swim       1.164947e-01
## Region     4.024083e-02
## IQ        -2.742712e-02
## attr(,&quot;name&quot;)
## [1] &quot;Regression coefficients for  Shoesize&quot;</code></pre>
</div>
<div id="result-object" class="section level4">
<h4>Result object</h4>
<p>Similar to PCA, model object contains list with result objects (<code>res</code>), obtained using calibration set (<code>cal</code>), cross-validation (<code>cv</code>) and test set validation (<code>test</code>). All three have class <code>plsres</code>, here is how <code>res$cal</code> looks like:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="models-and-results-1.html#cb163-1"></a><span class="kw">print</span>(m<span class="op">$</span>res<span class="op">$</span>cal)</span></code></pre></div>
<pre><code>## 
## PLS results (class plsres)
## 
## Call:
## plsres(y.pred = yp, y.ref = y.ref, ncomp.selected = object$ncomp.selected, 
##     xdecomp = xdecomp, ydecomp = ydecomp)
## 
## Major fields:
## $ncomp.selected - number of selected components
## $y.pred - array with predicted y values
## $y.ref - matrix with reference y values
## $rmse - root mean squared error
## $r2 - coefficient of determination
## $slope - slope for predicted vs. measured values
## $bias - bias for prediction vs. measured values
## $ydecomp - decomposition of y values (ldecomp object)
## $xdecomp - decomposition of x values (ldecomp object)</code></pre>
<p>The <code>xdecomp</code> and <code>ydecomp</code> are objects similar to <code>pcares</code>, they contain scores, residuals and variances for decomposition of X and Y correspondingly.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="models-and-results-1.html#cb165-1"></a><span class="kw">print</span>(m<span class="op">$</span>res<span class="op">$</span>cal<span class="op">$</span>xdecomp)</span></code></pre></div>
<pre><code>## 
## Results of data decomposition (class ldecomp).
## 
## Major fields:
## $scores - matrix with score values
## $T2 - matrix with T2 distances
## $Q - matrix with Q residuals
## $ncomp.selected - selected number of components
## $expvar - explained variance for each component
## $cumexpvar - cumulative explained variance</code></pre>
<p>Other fields are mostly various performance statistics, including slope, coefficient of determination (R<sup>2</sup>), bias, and root mean squared error (RMSE). Besides that, the results also include reference y-values and array with predicted y-values. The array has dimension <em>nObjects x nComponents x nResponses</em>.</p>
<p>PLS predictions for a new set can be obtained using method <code>predict</code>:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="models-and-results-1.html#cb167-1"></a>res =<span class="st"> </span><span class="kw">predict</span>(m, Xt, yt)</span>
<span id="cb167-2"><a href="models-and-results-1.html#cb167-2"></a><span class="kw">print</span>(res)</span></code></pre></div>
<pre><code>## 
## PLS results (class plsres)
## 
## Call:
## plsres(y.pred = yp, y.ref = y.ref, ncomp.selected = object$ncomp.selected, 
##     xdecomp = xdecomp, ydecomp = ydecomp)
## 
## Major fields:
## $ncomp.selected - number of selected components
## $y.pred - array with predicted y values
## $y.ref - matrix with reference y values
## $rmse - root mean squared error
## $r2 - coefficient of determination
## $slope - slope for predicted vs. measured values
## $bias - bias for prediction vs. measured values
## $ydecomp - decomposition of y values (ldecomp object)
## $xdecomp - decomposition of x values (ldecomp object)</code></pre>
<p>If reference y-values are not provided to <code>predict()</code> function, then all predictions are computed anyway, but performance statistics (and corresponding plot) will be not be available.</p>
</div>
</div>
<div id="model-validation-1" class="section level3">
<h3>Model validation</h3>
<p>Validation is implemented similar to SIMCA or PCA, the only difference is that you need to provide two datasets for a test set — one for predictors (<code>x.test</code>) and one for response (<code>y.test</code>) values. Cross-validation is very important for PLS as it helps to find optimal number of PLS components (so test set performance is more fair as in this case you do not use test set for optimization). Therefore, it is always recommended to use cross-validation for this purpose.</p>
<p>You probably have noticed a small warning we got when created the first PLS model in this chapter:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="models-and-results-1.html#cb169-1"></a>m =<span class="st"> </span><span class="kw">pls</span>(Xc, yc, <span class="dv">7</span>, <span class="dt">scale =</span> <span class="ot">TRUE</span>, <span class="dt">info =</span> <span class="st">&quot;Shoesize prediction model&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in selectCompNum.pls(model, selcrit = ncomp.selcrit): No
## validation results were found.</code></pre>
<p>When you create a model, it tries to select optimal number of components automatically (which, of course, you can always change later). To do that, the method uses RMSE values, calculated for different number of components and cross-validation predictions. So, if we do not use cross-validation, it warns user about this.</p>
<p>There are two different ways/criteria for automatic selection. One is using first local minimum on the RMSE plot and second is so called Wold criterion, based on a ratio between PRESS values for current and next component. You can select which criterion to use by specifying parameter <code>ncomp.selcrit</code> (either <code>'min'</code> or <code>'wold'</code>) as it is shown below.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="models-and-results-1.html#cb171-1"></a>m1 =<span class="st"> </span><span class="kw">pls</span>(Xc, yc, <span class="dv">7</span>, <span class="dt">scale =</span> <span class="ot">TRUE</span>, <span class="dt">cv =</span> <span class="dv">1</span>, <span class="dt">ncomp.selcrit =</span> <span class="st">&quot;min&quot;</span>)</span>
<span id="cb171-2"><a href="models-and-results-1.html#cb171-2"></a><span class="kw">show</span>(m1<span class="op">$</span>ncomp.selected)</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="models-and-results-1.html#cb173-1"></a>m2 =<span class="st"> </span><span class="kw">pls</span>(Xc, yc, <span class="dv">7</span>, <span class="dt">scale =</span> <span class="ot">TRUE</span>, <span class="dt">cv =</span> <span class="dv">1</span>, <span class="dt">ncomp.selcrit =</span> <span class="st">&quot;wold&quot;</span>)</span>
<span id="cb173-2"><a href="models-and-results-1.html#cb173-2"></a><span class="kw">show</span>(m2<span class="op">$</span>ncomp.selected)</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<p>And here are the RMSE plots (they are identical of course):</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="models-and-results-1.html#cb175-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb175-2"><a href="models-and-results-1.html#cb175-2"></a><span class="kw">plotRMSE</span>(m1)</span>
<span id="cb175-3"><a href="models-and-results-1.html#cb175-3"></a><span class="kw">plotRMSE</span>(m2)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-115-1.png" width="864" /></p>
<p>Parameter <code>cv</code> has the same format as for SIMCA. If it is a number, it will be used as number of segments for random cross-validation, e.g. if <code>cv = 2</code> cross-validation with two segments will be carried out. For full cross-validation use <code>cv = 1</code> like we did in the example above. For more advanced option you can provide a list with name of cross-validation method, number of segments and number of iterations, e.g. <code>cv = list("rand", 4, 4)</code> for running random cross-validation with four segments and four repetitions or <code>cv = list("ven", 8)</code> for systematic split into eight segments (<em>venetian blinds</em>).</p>
<p>Method <code>summary()</code> for model shows performance statistics calculated using optimal number of components for each of the results.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="models-and-results-1.html#cb176-1"></a><span class="kw">summary</span>(m1)</span></code></pre></div>
<pre><code>## 
## PLS model (class pls) summary
## -------------------------------
## Info: 
## Number of selected components: 5
## Cross-validation: full (leave one out)
## 
## Response variable: Shoesize
##     X cumexpvar Y cumexpvar    R2  RMSE Slope   Bias  RPD
## Cal    97.63961    98.18916 0.982 0.521 0.982 0.0000 7.59
## Cv           NA          NA 0.964 0.731 0.982 0.0064 5.41</code></pre>
<p>As you can see, there are no values for cumulative explained variance for cross-validation result, as we discussed in PCA/SIMCA.</p>
<p>If you want more details run <code>summary()</code> for one of the result objects.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="models-and-results-1.html#cb178-1"></a><span class="kw">summary</span>(m1<span class="op">$</span>res<span class="op">$</span>cal)</span></code></pre></div>
<pre><code>## 
## PLS regression results (class plsres) summary
## Info: calibration results
## Number of selected components: 5
## 
## Response variable Shoesize:
##        X expvar X cumexpvar Y expvar Y cumexpvar    R2  RMSE
## Comp 1   50.505      50.505   93.779      93.779 0.938 0.966
## Comp 2   20.979      71.484    2.926      96.705 0.967 0.703
## Comp 3    8.667      80.151    0.917      97.622 0.976 0.597
## Comp 4    5.847      85.998    0.479      98.101 0.981 0.534
## Comp 5   11.642      97.640    0.088      98.189 0.982 0.521
## Comp 6    0.495      98.135    0.347      98.536 0.985 0.468
## Comp 7    0.442      98.577    0.202      98.738 0.987 0.435
##        Slope Bias  RPD
## Comp 1 0.938    0 4.10
## Comp 2 0.967    0 5.63
## Comp 3 0.976    0 6.62
## Comp 4 0.981    0 7.41
## Comp 5 0.982    0 7.59
## Comp 6 0.985    0 8.44
## Comp 7 0.987    0 9.09</code></pre>
<p>In this case, the statistics are shown for all available components and explained variance for individual components is added.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="partial-least-squares-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="plotting-methods-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 1
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
